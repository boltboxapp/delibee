<!DOCTYPE html>
<html lang="ko-kr">
<head>
    <meta charset="UTF-8">
    <title>Delibee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Delibee, 국내 택배 배송 추적 라이브러리" />
    <meta name="keywords" content="delivery, tracking, delibee, 택배, 배송, 추적" />
    <link rel="stylesheet" type="text/css" href="css/nprogress.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/common.css" media="screen">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script src="js/tmpl.min.js"></script>
</head>
<body>
<section class="page-header">
    <h1 class="project-name">
        <img alt="Delibee" src="img/delibee.png" style="width: 200px;" />
    </h1>
    <h2 class="project-tagline">Delibee는 Node.js 기반의 국내 택배의 배송상황을 가져 올 수 있도록 만들어주는 라이브러리입니다.</h2>
    <a href="https://github.com/flosdor/delibee" class="btn">View on GitHub</a>
</section>

<section class="main-content">
    <h2>Delibee API Test</h2>
    <p>
        <form onSubmit="tracking(); return false;">
            <select id="delivery-company"></select>
            <input id="invoice-number" type="text" value="">
            <button id="btn-tracking" class="btn btn-black" type="submit">Tracking</button>
        </form>
        <div id="delibee-info"></div>
    </p>

    <div id="markdown-content"></div>

    <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/flosdor/delibee">Delibee</a> is maintained by <a href="https://github.com/flosdor">flosdor</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
    </footer>

</section>

<script type="text/x-tmpl" id="delibee-company-template">
    {% for (var key in o) { %}
    <option value="{%=key%}">{%=o[key]%}</option>
    {% } %}
</script>

<script type="text/x-tmpl" id="delibee-info-template">
    <table>
        <thead>
        <tr>
            <th>택배사</th>
            <th>송장번호</th>
            <th colspan="2">배송상태</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>{%=o.deliveryCompany.name%}</td>
            <td>{%=o.invoiceNumber%}</td>
            <td colspan="2">{%=o.statusText%}</td>
        </tr>
        {% if (o.senderName && o.receiverName) { %}
        <tr>
            <th>보낸이</th>
            <td>{%=o.senderName%}</td>
            <th>받는이</th>
            <td>{%=o.receiverName%}</td>
        </tr>
        {% } %}
        </tbody>
    </table>
    <br>
    <table>
        <thead>
        <tr>
            <th>처리일시</th>
            <th>위치</th>
            <th>배송상태</th>
        </tr>
        </thead>
        <tbody>
        {% for (var i = 0; i < o.history.length; i += 1) { %}
        <tr>
            <td>{%=o.history[i].dateString%}</td>
            <td>{%=o.history[i].location%}</td>
            <td>{%=o.history[i].statusText%}</td>
        </tr>
        {% } %}
        </tbody>
    </table>
</script>

<script>
  function tracking() {
    var deliveryCompany = document.getElementById('delivery-company');
    var invoiceNumber = document.getElementById('invoice-number');
    var btnTracking = document.getElementById('btn-tracking');
    if (invoiceNumber.disabled || btnTracking.disabled) {
      return;
    }
    deliveryCompany.disabled = invoiceNumber.disabled = btnTracking.disabled = true;
    NProgress.start();
    NProgress.inc();
    axios
      .get('https://delibee.hyungdew.com/tracking', {
        params: {
          'company': deliveryCompany.value,
          'invoice_no': invoiceNumber.value
        }
      })
      .then(function (res) {
        NProgress.inc();
        var data = res.data;
        if (data.success && data.invoice) {
          document.getElementById('delibee-info').innerHTML = tmpl("delibee-info-template", data.invoice);
        } else {
          document.getElementById('delibee-info').innerHTML = '';
          data.message && alert(data.message);
        }
        deliveryCompany.disabled = invoiceNumber.disabled = btnTracking.disabled = false;
        NProgress.done();
      })
      .catch(function () {
        NProgress.done();
      });
  }
  function loadDeliveryCompanies() {
    axios.get('https://delibee.hyungdew.com/tracking/companies').then(function (res) {
      document.getElementById('delivery-company').innerHTML = tmpl("delibee-company-template", res.data);
    });
  }
  function loadReadme() {
    axios.get('./README.md').then(function (res) {
      document.getElementById('markdown-content').innerHTML = marked(res.data);
    });
  }
  loadDeliveryCompanies();
  loadReadme();
</script>

</body>
</html>
